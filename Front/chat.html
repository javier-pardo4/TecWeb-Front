<html>
    <head>
        <title>Chat</title>
    </head>
    <body>
        <input type="text" id="nombre" placeholder="Nombre">
        <button onclick="conectar()">Conectar</button>
        <br>

        <input type="text" id="mensaje"><button onclick="enviar()">Enviar</button>
        <br>
        <input type="text" id="destinatario" value="Ana">

        <span id="estado">No conectar</span>
        <div id="mensajes"></div>
        <div id="usuarios">Usuarios:</div>
    </body>

    <script>
        let ws;  
        function enviar() {
            let texto = document.getElementById("mensaje").value;
            let cajaDestinatario = document.getElementById("destinatario");
            let mensaje = {
                contenido: texto
            };
            if (cajaDestinatario.value == "") {
                mensaje.tipo = "mensajeParticular";
                mensaje.destinatario = cajaDestinatario.value;
            } else
                mensaje.tipo = "difusion";

            ws.send(JSON.stringify(mensaje));
        }
        function conectar() {
            ws = new WebSocket("ws://localhost:80/wsChat?nombre="+ document.getElementById("nombre").value);
            ws.onopen = function() {
                document.getElementById("estado").innerHTML = "Conectado";
            }
            ws.onerror = function() {
                document.getElementById("estado").innerHTML = "Error "+e.message;
            }
            ws.onmessage = function(e) {
                let divMensaje = document.createElement("div");

                let jso = JSON.parse(e.data);


                divMensaje.innerHTML = jso.contenido;

                if (jso.tipo == "llegadaDeUsuario")
                    document.getElementById("usuarios").appendChild(divMensaje);
                else
                    document.getElementById("mensajes").appendChild(divMensaje);

                document.getElementById("mensajes").appendChild(divMensaje);
            }
        }
    </script>

</html>